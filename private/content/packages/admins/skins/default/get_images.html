<div class="uk-block uk-padding-remove">
<div class="uk-grid">
<%loop $images as $i%>
  <div class="uk-width-2-10" style="">
    <table>
      <tr>
        <td style="border-left:1px dotted #888;border-top:1px dotted #888;border-bottom:1px dotted #888"><a href="<%$base_url%>/<%$i.image_name%>/a.jpg" class="_images" rel="imggroup"><img src="<%$base_url%>/<%$i.image_name%>/c.jpg"></a></td>
        <td valign="top" style="border-right:1px dotted #888;border-top:1px dotted #888;border-bottom:1px dotted #888">
          <div class="remove_img" imgid="<%$i.image_name%>" style="font-size: 1.2em;cursor:pointer;color:#cc0000">X</div>
          <div class="sort_img" direct="up" imgid="<%$i.image_name%>" style="font-size: 2em;cursor:pointer">&laquo;</div>
          <div class="sort_img" direct="down" imgid="<%$i.image_name%>" style="font-size: 2em;cursor:pointer">&raquo;</div>
        </td>
      </tr>
    </table>
  </div>
<%/loop%>
</div>
</div>
<script type="text/javascript">
  $('.remove_img').click(function(){
    var imgid = $(this).attr('imgid');
    if(confirm('Удалить изображение')) {
      $.post(
        '/cgi-bin/index.cgi',
        {
          pkg: 'content:admins',
          action: 'get_images',
          remove: 'yes',
          image_name: imgid,
          model_id: <%$query.model_id%>
        },
        function(data, textStatus){
          var images = jQuery.parseJSON(data);
          if(!images['html']) {
            $('#iset').css('display', 'block');
            $('#iset').html('<div style="display:inline">Нет изображений</div>');
          } else {
            $('#iset').css('display', 'block');
            $('#iset').html(images['html']);
          }
        }
      );      
    }
  });
  $('.sort_img').click(function(){
    var imgid = $(this).attr('imgid');
    var direct = $(this).attr('direct');
    $.post(
      '/cgi-bin/index.cgi',
      {
        pkg: 'content:admins',
        action: 'get_images',
        sort: 'yes',
        image_name: imgid,
        direct: direct,
        model_id: <%$query.model_id%>
      },
      function(data, textStatus){
        var images = jQuery.parseJSON(data);
        if(!images['html']) {
          $('#iset').css('display', 'block');
          $('#iset').html('<div style="display:inline">Нет изображений</div>');
        } else {
          $('#iset').css('display', 'block');
          $('#iset').html(images['html']);
        }
      }
    );      
  });
  $("a._images").fancybox({
    helpers: {
      overlay: {
        locked: false
      }
    },
    'transitionIn'  :       'elastic',
    'transitionOut' :       'elastic',
    'speedIn'       :       600, 
    'speedOut'      :       200, 
    'overlayShow'   :       false
  });
</script>